@Injectable({ providedIn: 'root' })
export class EligibilityGuard implements CanActivateChild {
  private authService: any;

  async loadAuth() {
    if (!this.authService) {
      const m = await loadRemoteModule({
        type: 'module',
        remoteEntry: 'http://localhost:4200/remoteEntry.js',
        exposedModule: './AuthService'
      });
      this.authService = new m.AuthService();
    }
    return this.authService;
  }

  async canActivateChild(): Promise<boolean> {
    const auth = await this.loadAuth();
    const isEligible = await firstValueFrom(auth.checkEligibility());
    return isEligible;
  }
}
