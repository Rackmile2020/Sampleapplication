autoOnce(
  streamMethod: string,
  streamArgsOrTriggerMethod?: any[] | string | ((data: any, err?: any) => void),
  triggerMethodOrCallback?: string | ((data: any, err?: any) => void),
  triggerArgsOrCallback?: any[] | ((data: any, err?: any) => void),
  callback?: (data: any, err?: any) => void
): Promise<any> {
  let streamArgs: any[] = [];
  let triggerMethod: string | null = null;
  let triggerArgs: any[] = [];
  let cb: (data: any, err?: any) => void = () => {};

  // ðŸ§  Handle all possible call formats
  if (Array.isArray(streamArgsOrTriggerMethod)) {
    streamArgs = streamArgsOrTriggerMethod;
  } else if (typeof streamArgsOrTriggerMethod === 'function') {
    cb = streamArgsOrTriggerMethod;
  } else if (typeof streamArgsOrTriggerMethod === 'string') {
    triggerMethod = streamArgsOrTriggerMethod;
  }

  if (typeof triggerMethodOrCallback === 'function') {
    cb = triggerMethodOrCallback;
  } else if (typeof triggerMethodOrCallback === 'string') {
    triggerMethod = triggerMethodOrCallback;
  }

  if (Array.isArray(triggerArgsOrCallback)) {
    triggerArgs = triggerArgsOrCallback;
  } else if (typeof triggerArgsOrCallback === 'function') {
    cb = triggerArgsOrCallback;
  }

  const freshEveryTime = streamArgs[streamArgs.length - 1] === true;

  // ðŸ§© Decide what to use: call() or stream()
  const source$ = freshEveryTime
    ? this.call(streamMethod, ...streamArgs)
    : this.stream(streamMethod, ...streamArgs);

  // ðŸ”” Optionally trigger once
  if (triggerMethod) {
    this.callOnce(triggerMethod, ...triggerArgs);
  }

  // ðŸŽ¯ Return a Promise that resolves once
  return new Promise((resolve, reject) => {
    const obs$ = source$ instanceof Observable ? source$ : of(source$);
    const sub = obs$.pipe(first()).subscribe({
      next: (data) => {
        cb(data, null);
        resolve(data);
      },
      error: (err) => {
        cb(null, err);
        reject(err);
      },
      complete: () => sub.unsubscribe(),
    });
  });
}

this.autoOnce('getUserStream', (res, err) => {
  if (err) console.error(err);
  else console.log(res);
});
