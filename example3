function encodeBase64(data: any): string {
  // If object → convert to JSON string
  const str = typeof data === 'string' ? data : JSON.stringify(data);

  const utf8Bytes = new TextEncoder().encode(str);
  const binaryString = Array.from(utf8Bytes)
    .map(b => String.fromCharCode(b))
    .join('');
  return btoa(binaryString);
}

function decodeBase64(b64: string): any {
  const binary = atob(b64);
  const bytes = Uint8Array.from(binary, c => c.charCodeAt(0));
  const decoded = new TextDecoder().decode(bytes);

  // Try JSON.parse
  try {
    return JSON.parse(decoded);
  } catch {
    return decoded;   // It’s just HTML or text
  }
}
